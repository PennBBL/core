[uwsgi]
die-on-term = true
master = true
module = api.wsgi
processes = 4
threads = 2
socket-timeout = 60

# Setup environment for Prometheus multi-process monitoring
env = prometheus_multiproc_dir=/tmp/prometheus
exec-asap = (rm -rf /tmp/prometheus; mkdir -p /tmp/prometheus) || true

# Start the metrics mule process, and assign it to a farm
# See: https://uwsgi-docs.readthedocs.io/en/latest/Mules.html
mule = /var/scitran/code/api/api/metrics/mule.py
farm = metrics:1


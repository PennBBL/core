[uwsgi]
die-on-term = true
master = true
module = api.wsgi
processes = 4
gevent = 1000
gevent-monkey-patch = true
socket-timeout = 60

# Setup environment for Prometheus multi-process monitoring
env = prometheus_multiproc_dir=/tmp/prometheus
exec-asap = (rm -rf /tmp/prometheus; mkdir -p /tmp/prometheus) || true

# Start the metrics mule process, and assign it to a farm
# See: https://uwsgi-docs.readthedocs.io/en/latest/Mules.html
mule = /var/scitran/code/api/api/metrics/mule.py
farm = metrics:1

# Handle sendfile responses
collect-header = X-Sendfile X_SENDFILE
response-route-if-not = empty:${X_SENDFILE} static:${X_SENDFILE}
